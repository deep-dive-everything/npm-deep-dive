## 2.5 node_modules는 무엇일까?

### 2.5.1 node_modules의 역할

- 의존성 관리: package.json에 명시된 의존성 목록을 기준으로 필요한 패키지들을 설치해서 관리
- 경로 해결: require()나 import로 모듈을 가져올 때 해당 모듈을 검색하는 주요 경로가 됨
- 네임스페이스 관리: 의존성 트리 내 여러 패키지가 동일한 이름의 모듈을 필요로 할때 중복 모듈이 서로 영향을 미치지 않도록 네임스페이스 관리

### 2.5.2 node_modules의 구조

#### 2.5.2.1 .bin

- bin 필드는 패키지의 실행 가능한 스크립트 혹은 바이너리 파일을 정의하는 데 사용됨
- bin 필드가 정의된 패키지를 설치하면 패키지 관리자는 해당 실행 파일들을 node_modules/.bin 폴더에 심볼릭 링크로 생성
- 이제 해당 패키지를 명령어로 직접 실행 가능

#### 2.5.2.2 서브 패키지 node_modules 폴더

- 여러 패키지에서 동일한 패키지의 동일 버전에 의존할 경우 최상위 Node_modules 폴더에 설치하고 의존하는 버전이 서로 다를 경우에는 개별 패키지의 Node_modules 서브 폴더에 필요한 버전을 추가로 설치해서 관리

#### 2.5.2.3 .Cache

- node_modules/.cache 폴더는 여러 빌드 도구와 패키지 관리 도구들이 성능 향상을 위해 캐시 데이터를 저장하는 장소로 사용됨
- 대표적인 예로 웹팩과 바벨. (빌드 시간 단축시키기 위해 사용)

### 2.5.3 심볼릭 링크

- 심볼릭 링크는 파일 시스템 내에서 특정 파일이나 디렉터리에 대한 참조를 다른 위치에 생성하는 기능
- 실제 파일의 복사본이 아닌 원본 경로를 참조해서 원본 파일에 접근하는 링크 역할을 함

#### 2.5.3.1 심볼릭 링크 직접 활용하기

- 로컬에서 구현한 패키지를 심볼릭 링크로 생성한 뒤 이를 다른 로컬 프로젝트에서 사용가능
- sleep이란 패키지 만들고 npm link 실행하여 심볼릭 링크를 전역에 생성
- 다른 패키지에서 npm link sleep이라 실행하고 패키지 불러와 사용 가능
- node_modules를 오염시키지 않기 위해 unlink로 잘 정리해줄 필요있음

#### 2.5.3.2 node_modules에서 심볼릭 링크의 활용

- node_modules/.bin
  - 많은 npm 패키지가 CLI 도구를 제공하며, 이러한 CLI 도구가 node_modules/.bin 폴더에 심볼릭 링크로 연결되어 프로젝트 내에서 쉽게 실행됨
- 워크스페이스
  - npm 워크스페이스는 여러 패키지를 하나의 프로젝트 내에서 함께 관리할 수 있게 해주는 기능
  - 워크스페이스를 사용하면 각 패키지가 node_modules 폴더 내에서 심볼릭 링크로 연결되어 의존성을 설치할 때 별도의 패키지 관리 없이도 각 패키지 간의 참조가 자동으로 처리됨
- 패키지 관리자
  - pnpm은 디스크 공간 절약과 패키지 설치 속도 향상을 위해 심볼릭 링크를 적극적으로 활용하는 패키지 관리자

## 2.6 bin 필드와 npx

### 2.6.1 CLI 패키지

- CLI 패키지는 CLI를 통해 사용되는 소프트웨어 패키지를 의미하며 주로 터미널 같은 명령 프롬프트에서 패키지 명령어를 입력해서 실행할 수 잇음
- 대표적인 CLI 도구
  - create-react-app, prettier, eslint, typescript, webpack, pm2

### 2.6.2 bin 필드

#### 2.6.2.1 bin 필드 설정하기

- bin 필드에 실행할 스크립트 파일의 상대 경로를 지정하면 패키지 이름 자체가 실행 가능한 명령어로 사용됨
- 실행 파일을 작성할 때는 몇가지 조건을 충족해야 함
  - 실행 가능 권한 설정: chmod 등으로 권한 설정
  - 셔뱅 라인 추가: Node.js 스크립트로 실행할 파일임을 나타내기 위해 파일 첫줄에 셔뱅라인추가

```
#!/user/bin/env node
```

#### 2.6.2.2 패키지의 설치와 실행

- 패키지가 다른 패키지의 의존성으로 설치될 때 bin 필드에 정의된 파일은 다음 두 가지 방법으로 사용할 수 있도록 링크됨
  - npx 혹은 npx exec를 통해 직접 접근
  - npm run-script로 호출

### 2.6.3 npx

- 개발자가 npm 패키지를 손쉽게 실행하고 관리할 수 있도록 돕는 명령어 실행 도구
- npx의 주요 기능
  - 로컬 패키지 실행: 로컬 프로젝트에 설치된 Node.js 패키지를 바로 실행할 수 있음
  - 전역 설치 없이 실행: 특정 패키지를 일회성으로 실행할 수 있어 전역설치가 불필요
  - 특정 버전의 패키지 실행: 특정 버전의 패키지를 지정해서 실행할 수 있음
  - 스크립트 실행: -c 옵션을 사용해 임시 스크립트를 실행할 수 있음

#### 2.6.3.1 npx에서 사용할 수 있는 옵션

- --package(-p): 특정 패키지를 지정해서 명령어를 실행할 수 있는 옵션
- -c: npm run -script와 비슷하게 셸 환경에서 문자열을 실행할 수 있음
- --yes와 --no: 설치여부를 묻지 않고 자동으로 설치 및 실행

#### 2.6.3.2 npx는 어떻게 패키지를 찾아서 실행할까

1. 입력 명령어 파싱: 사용자가 입력한 명령어와 인자를 파싱해서 실행할 패키지의 이름과 필요 시 버전을 결정
2. 로컬 패키지 탐색: 현재 작업 중인 디렉터리의 node_modules/.bin 폴더에서 실행 파일을 찾음
3. 캐시 확인: 로컬에 패키지가 없는 경우 캐시 폴더에서 찾음
4. 레지스트리에서 패키지 검색: 둘다 없는 경우 npm 레지스트리에서 해당 패키지를 검색해 최신 버전을 가져옴
5. 패키지 설치: 레지스트리에서 찾으면 임시 디렉터리에 다운로드해서 설치. 전역으로 설치되지 않고 일시적으로 저장됨
6. 패키지 실행: 패키지가 준비되면 npx는 해당 패키지의 실행 파일을 찾아 실행
7. 패키지 정리: 실행이 끝나면 임시 디렉터리에 설치된 패키지 정리

#### 2.6.3.3 npx와 npx exec의 차이점

- npx를 사용할 때는 모든 플래그와 옵션을 명령어를 실행하기 전에 먼저 설정해야함.
- npx exec는 플래그와 옵션이 명령어 이후에 위치해도 인자로 잘 전달됨
