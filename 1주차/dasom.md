# Npm Deep Dive

Dasom, 2025.08.31

## 1장 npm과 유의적 버전

### 1.1 npm의 정의와 역사

> npm은 아이작 Z.슐루터에 의해 만들어졌으며, npm을 통해 전 세계에서 업로드된 자바스크립트 패키지를 쉽게 설치하고 업데이트하며 프로젝트 간의 의존성을 효율적으로 관리할 수 있다. 
>
> cf. npm은 node package manager의 약어가 아닌, 하나의 단어로 보는 게 맞다.

**npm의 역사와 배경**

* 2010 npm@1.0.0 등장
* 초기: Node.js 생태계에서 동작하는 코드만 업로드
* 페이스북이 리액트를 npm에 올리는 시점즈음부터 프런트엔드에서 동작하는 자바스크립트 코드도 CDN -> npm 업로드 방식으로 변경
* 2020년 깃허브의 npm 인수



**npm의 주요기능**

* 패키지 설치 및 관리
* 패키지 배포 및 공유
* 스크립트 실행
* npmjs.com <- npm에 업로드돼 있는 패키지에 대한 정보를 쉽게 확인할 수 있는 사이트



**npm과 관련된 유용한 사이트**

* 번들포비아: npm에 업로드돼있는 패키지의 크기 관련 정보
* npm 트렌드: 패키지 다운로드 횟수 확인 및 비교
* unpkg: 실제 npm에 업로드 되어있는 파일 확인
* snky: 오픈소스 보안 취약점 확인 가능 (npm 외 여러 오픈소스 포함)



### 1.2 유의적 버전이란?

> 유의적 버전(semantic version)이란 일종의 버전 선언 규칙이다.
>
> 계속해서 변화하는 의존성으로 인한 혼란을 제어하기 위해 만들어졌다.



**버전은 주.부.수(Major.Minor.Patch)로 이뤄진다.**

* 기존 버전과 호환되지 않는 API 변경 사항이 있다면 주 버전이 올라간다.
* 기존 버전과 호환되면서 새로운 기능이 추가되면 부 버전을 올린다.
* 기존 버전과 호환되면서 버그를 수정한 것이라면 수 버전을 올린다.



**유의적 버전의 구체적인 명세**

* 유의적 버전을 쓰는 소프트웨어는 반드시 공개 API를 선언한다. 이 API는 코드 자체로 선언하거나 문서로 엄격히 명시해야 한다. 어떤 방식으로든 정확하고 이해하기 쉬워야 한다.
* 보통 버전 번호는 반드시 X.Y.Z의 형태로 하고, X.Y.Z의 형태는 각각 자연수이고, 절대로 0이 앞에 붙어서는 안 된다. X는 주 버전 번호이고, Y는 부 버전 번호이며, Z는 수 버전 번호이다. 각각은 반드시 증가하는 수여야 한다. 
* 특정 버전으로 패키지를 배포하고 나면 해당 버전의 내용은 절대 변경하지 말아야 한다. 변경분이 있다면 반드시 새로운 버전으로 배포한다.
* 주 버전(0.y.z)은 초기 개발을 위해서 쓴다. 아무 때나 마음대로 바꿀 수 있다. 이 공개 API는 안정판으로 보지 않는 게 좋다.
* 1.0.0버전은 공개 API를 정의한다. 이후의 버전 번호는 이때 배포한 공개 API에서 어떻게 바뀌는지에 따라 올린다.
* 수 버전 Z는 반드시 그 전 버전 API와 호환되는 버그 수정인 경우에만 올린다. 버그 수정은 잘못된 내부 기능을 고치는 것으로 정의한다.
* 공개 API에 기존과 호환되는 새로운 기능을 추가할 때는 반드시 부 버전을 올린다. 공개 API의 일부를 앞으로 제거할 것으로 표시한 경우에도 반드시 올리도록 한다. 내부 비공개 코드에 새로운 기능이 대폭 추가되거나 개선사항이 있을 때도 올릴 수 있다. 부 버전을 올릴 때 수 버전을 올릴 때만큼의 변화를 포함할 수도 있다. 부 버전이 올라가면 수 버전은 반드시 0에서 다시 시작한다.
* 공개 API에 기존과 호환되지 않는 변화가 있을 때는 반드시 주 버전을 올린다. 주 버전을 올릴 때는 반드시 부 버전과 수 버전을 0으로 초기화 한다.
* 수 버전 바로 뒤에 붙임표(-)를 붙이고 마침표(.)로 구분된 식별자를 더해서 정식 배포를 앞둔 버전을 표시할 수 있다. 예: 1.0.0-alpha
* 빈드 메타데이터는 수 버전이나 정식 배포 전 식별자 뒤에 더하기(+) 기호를 붙인 뒤에 마침표로 구분된 식별자를 덧붙여서 표현할 수 있다. 예: 1.0.0-alpha+001
* 우선순위는 버전의 순서를 정렬할 때 서로를 어떻게 비교할지를 나타낸다. 우선순위는 반드시 주.부.수 버전, 그리고 정식 배포 전 버전의 식별자를 나누어 계산하도록 한다. 

cf. rc: release candidate의 약자로 정식 버전이 되기 직전의 버전을 의미 (즉, rc식별자가 추가됐다는 것은 정식 버전 출시 임박을 의미)



**유의적 버전의 문법**

* 정규 표현식을 사용해 문자열이 유의적 버전 문법에 맞는지 검증할 수 있지만, 일반적으로는 semver라는 js 패키지를 통해 검증한다.



### 1.3 유의적 버전과 npm 생태계의 명과 암

> ^는 package.json의 depndencies의 버전을 명시하는 문법으로, ^을 선헌하면 해당 버전을 기준으로 그보다 더 높은 부 버전가지는 모두 호환된다는 것을 의미한다. 비슷하게 ~는 수버전까지만 가능하다는 의미이다.



**유의적 버전과 npm을 사용할 때 주의할 점**

* 유의적 버전은 규약일 뿐이다: 새로운 버전의 패키지 설치 전에는 최소한 CHANGELOG라도 살펴보자.
* 무조건 설치하는 것이 능사는 아니다
  * 정말로 대체 불가능한 패키지인가
  * 사용할 수 있는 만큼 충분히 검증됐는가
  * 타당한 dependencies를 가지고 있는가
* 락 파일 변경에 주의를 기울이기
  * 변경 내용 파악이 어려운 경우 npm install 대신 npm ci를 사용해 락 파일이 변경되지 않도록 해야 한다. 
* 보안 취약점에 귀 기울이기(snyk사이트 참고)

